!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.CanvasRange={})}(this,function(t){"use strict";function e(t,e){function i(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function i(t,e,i,n){return new(i||(i=Promise))(function(o,s){function r(t){try{u(n.next(t))}catch(t){s(t)}}function a(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(r,a)}u((n=n.apply(t,e||[])).next())})}function n(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(r=2&i[0]?s.return:i[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,i[1])).done)return r;switch(s=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,s=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(r=u.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],s=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,s,r,a,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function o(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}function r(t){var e=new Date(1e3*t);return e.getFullYear()+"-"+(e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())}var a,u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},l=.017453292519943295,h=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.values=new Float32Array([t,e])}return t.prototype.toString=function(){return" [ "+this.values[0]+" , "+this.values[1]+" ] "},Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),t.prototype.reset=function(t,e){return void 0===t&&(t=0),this.values[0]=t,this.values[1]=e,this},t.prototype.equals=function(t){return!(Math.abs(this.values[0]-t.values[0])>1e-5)&&!(Math.abs(this.values[1]-t.values[1])>1e-5)},t.prototype.negative=function(){return this.values[0]=-this.values[0],this.values[1]=-this.values[1],this},Object.defineProperty(t.prototype,"squaredLength",{get:function(){var t=this.values[0],e=this.values[1];return t*t+e*e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.squaredLength)},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){var t=this.length;return f.isEquals(t,0)?(console.log(" the length = 0 "),this.values[0]=0,this.values[1]=0,0):f.isEquals(t,1)?(console.log(" the length = 1 "),1):(this.values[0]/=t,this.values[1]/=t,t)},t.create=function(e,i){return void 0===e&&(e=0),void 0===i&&(i=0),new t(e,i)},t.prototype.add=function(e){return t.sum(this,e,this),this},t.sum=function(e,i,n){return void 0===n&&(n=null),null===n&&(n=new t),n.values[0]=e.values[0]+i.values[0],n.values[1]=e.values[1]+i.values[1],n},t.prototype.substract=function(e){return t.difference(this,e,this),this},t.difference=function(e,i,n){return void 0===n&&(n=null),null===n&&(n=new t),n.values[0]=e.values[0]-i.values[0],n.values[1]=e.values[1]-i.values[1],n},t.copy=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t),i.values[0]=e.values[0],i.values[1]=e.values[1],i},t.scale=function(e,i,n){return void 0===n&&(n=null),null===n&&(n=new t),n.values[0]=e.values[0]*i,n.values[1]=e.values[1]*i,n},t.scaleAdd=function(e,i,n,o){return void 0===o&&(o=null),null===o&&(o=new t),t.scale(i,n,o),t.sum(e,o,o)},t.moveTowards=function(e,i,n,o){return void 0===o&&(o=null),null===o&&(o=new t),t.scale(i,n,o),t.sum(e,o,o)},t.prototype.innerProduct=function(e){return t.dotProduct(this,e)},t.dotProduct=function(t,e){return t.values[0]*e.values[0]+t.values[1]*e.values[1]},t.crossProduct=function(t,e){return t.x*e.y-t.y*e.x},t.getOrientation=function(e,i,n){void 0===n&&(n=!1);var o=t.difference(i,e),s=Math.atan2(o.y,o.x);return!1===n&&(s=f.toDegree(s)),s},t.getAngle=function(e,i,n){void 0===n&&(n=!1);var o=t.dotProduct(e,i),s=Math.acos(o/(e.length*i.length));return!1===n&&(s=f.toDegree(s)),s},t.cosAngle=function(e,i,n){return void 0===n&&(n=!1),!0===n&&(e.normalize(),i.normalize()),t.dotProduct(e,i)},t.sinAngle=function(t,e,i){return void 0===i&&(i=!1),!0===i&&(t.normalize(),e.normalize()),t.x*e.y-e.x*t.y},t.zero=new t(0,0),t.xAxis=new t(1,0),t.yAxis=new t(0,1),t.nXAxis=new t(-1,0),t.nYAxis=new t(0,-1),t.temp=new t(0,0),t.temp1=new t(0,0),t}(),c=(function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.values=new Float32Array([t,e,i])}Object.defineProperty(t.prototype,"x",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),t.cross=function(e,i,n){return void 0===n&&(n=null),null===n&&(n=new t),n.x=e.y*i.z-e.z*i.y,n.y=e.z*i.x-e.x*i.z,n.z=e.x*i.y-e.y*i.x,n},t.prototype.toString=function(){return" [ "+this.values[0]+" , "+this.values[1]+" , "+this.values[2]+" ] "}}(),function(){function t(t,e,i,n,o,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=0),this.values=new Float32Array([t,e,i,n,o,s])}return t.prototype.identity=function(){this.values[0]=1,this.values[1]=0,this.values[2]=0,this.values[3]=1,this.values[4]=0,this.values[5]=0},t.create=function(e,i,n,o,s,r){return void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===r&&(r=0),new t(e,i,n,o,s,r)},Object.defineProperty(t.prototype,"xAxis",{get:function(){return h.create(this.values[0],this.values[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yAxis",{get:function(){return h.create(this.values[2],this.values[3])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return h.create(this.values[4],this.values[5])},enumerable:!0,configurable:!0}),t.prototype.getAngle=function(t){void 0===t&&(t=!1);var e=Math.atan2(this.values[1],this.values[0]);return t?e:e/l},t.copy=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t),i.values[0]=e.values[0],i.values[1]=e.values[1],i.values[2]=e.values[2],i.values[3]=e.values[3],i.values[4]=e.values[4],i.values[5]=e.values[5],i},t.multiply=function(e,i,n){void 0===n&&(n=null),null===n&&(n=new t);var o=e.values[0],s=e.values[1],r=e.values[2],a=e.values[3],u=e.values[4],l=e.values[5],h=i.values[0],c=i.values[1],d=i.values[2],f=i.values[3],p=i.values[4],v=i.values[5];return n.values[0]=o*h+r*c,n.values[1]=s*h+a*c,n.values[2]=o*d+r*f,n.values[3]=s*d+a*f,n.values[4]=o*p+r*v+u,n.values[5]=s*p+a*v+l,n},t.determinant=function(t){return t.values[0]*t.values[3]-t.values[2]*t.values[1]},t.invert=function(e,i){var n=t.determinant(e);return!f.isEquals(n,0)&&(n=1/n,i.values[0]=e.values[3]*n,i.values[1]=-e.values[1]*n,i.values[2]=-e.values[2]*n,i.values[3]=e.values[0]*n,i.values[4]=(e.values[2]*e.values[5]-e.values[3]*e.values[4])*n,i.values[5]=(e.values[1]*e.values[4]-e.values[0]*e.values[5])*n,!0)},t.makeRotation=function(e,i){void 0===i&&(i=null),null===i&&(i=new t);var n=Math.sin(e),o=Math.cos(e);return i.values[0]=o,i.values[1]=n,i.values[2]=-n,i.values[3]=o,i.values[4]=0,i.values[5]=0,i},t.prototype.onlyRotationMatrixInvert=function(){var t=this.values[1];return this.values[1]=this.values[2],this.values[2]=t,this},t.makeRotationFromVectors=function(e,i,n,o){return void 0===n&&(n=!1),void 0===o&&(o=null),null===o&&(o=new t),o.values[0]=h.cosAngle(e,i,n),o.values[1]=h.sinAngle(e,i,n),o.values[2]=-h.sinAngle(e,i,n),o.values[3]=h.cosAngle(e,i,n),o.values[4]=0,o.values[5]=0,o},t.makeReflection=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t),i.values[0]=1-2*e.x*e.x,i.values[1]=-2*e.x*e.y,i.values[2]=-2*e.x*e.y,i.values[3]=1-2*e.y*e.y,i.values[4]=0,i.values[5]=0,i},t.makeXSkew=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t),i.values[0]=1,i.values[1]=0,i.values[2]=e,i.values[3]=1,i.values[4]=0,i.values[5]=0,i},t.makeYSkew=function(e,i){return void 0===i&&(i=null),null===i&&(i=new t),i.values[0]=1,i.values[1]=e,i.values[2]=0,i.values[3]=1,i.values[4]=0,i.values[5]=0,i},t.makeTranslation=function(e,i,n){return void 0===n&&(n=null),null===n&&(n=new t),n.values[0]=1,n.values[1]=0,n.values[2]=0,n.values[3]=1,n.values[4]=e,n.values[5]=i,n},t.makeScale=function(e,i,n){if(void 0===n&&(n=null),f.isEquals(e,0)||f.isEquals(i,0))throw alert(" x轴或y轴缩放系数为0 "),new Error(" x轴或y轴缩放系数为0 ");return null===n&&(n=new t),n.values[0]=e,n.values[1]=0,n.values[2]=0,n.values[3]=i,n.values[4]=0,n.values[5]=0,n},t.temp1=t.create(),t.temp2=t.create(),t.quadBezierBasicMatrix=t.create(1,-2,-2,2,1,0),t}()),d=function(){function t(){this._mats=[],this._mats.push(new c)}return Object.defineProperty(t.prototype,"matrix",{get:function(){if(0===this._mats.length)throw alert(" 矩阵堆栈为空 "),new Error(" 矩阵堆栈为空 ");return this._mats[this._mats.length-1]},enumerable:!0,configurable:!0}),t.prototype.pushMatrix=function(){var t=c.copy(this.matrix);this._mats.push(t)},t.prototype.popMatrix=function(){if(0===this._mats.length)return void alert(" 矩阵堆栈为空 ");this._mats.pop()},t.prototype.loadIdentity=function(){this.matrix.identity()},t.prototype.loadMatrix=function(t){c.copy(t,this.matrix)},t.prototype.multMatrix=function(t){c.multiply(this.matrix,t,this.matrix)},t.prototype.translate=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=c.makeTranslation(t,e);this.multMatrix(i)},t.prototype.rotate=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),!1===e&&(t=f.toRadian(t));var i=c.makeRotation(t);this.multMatrix(i)},t.prototype.rotateFrom=function(t,e,i){void 0===i&&(i=!1);var n=c.makeRotationFromVectors(t,e,i);this.multMatrix(n)},t.prototype.scale=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);var i=c.makeScale(t,e);this.multMatrix(i)},t.prototype.invert=function(){var t=new c;if(!1===c.invert(this.matrix,t))throw alert(" 堆栈顶部矩阵为奇异矩阵，无法求逆 "),new Error(" 堆栈顶部矩阵为奇异矩阵，无法求逆 ");return t},t}(),f=function(){function t(){}return t.toRadian=function(t){return t*l},t.toDegree=function(t){return t/l},t.random=function(t,e){return Math.random()*e+t},t.angleSubtract=function(t,e){for(var i=e-t;i>180;)i-=360;for(;i<-180;)i+=360;return i},t.isEquals=function(t,e,i){return void 0===i&&(i=1e-5),!(Math.abs(t-e)>=1e-5)},t.getQuadraticBezierPosition=function(t,e,i,n){if(n<0||n>1)throw alert(" t的取值范围必须为[ 0 , 1 ] "),new Error(" t的取值范围必须为[ 0 , 1 ] ");var o=1-n;return o*o*t+2*n*o*e+n*n*i},t.getQuadraticBezierVector=function(e,i,n,o,s){return void 0===s&&(s=null),null===s&&(s=h.create()),s.x=t.getQuadraticBezierPosition(e.x,i.x,n.x,o),s.y=t.getQuadraticBezierPosition(e.y,i.y,n.y,o),s},t.getQuadraticBezierMat=function(t,e,i,n,o){return void 0===o&&(o=null),null===o&&(o=h.create()),o},t.getCubicBezierPosition=function(t,e,i,n,o){if(o<0||o>1)throw alert(" t的取值范围必须为[ 0 , 1 ] "),new Error(" t的取值范围必须为[ 0 , 1 ] ");var s=1-o,r=o*o;return s*s*s*t+3*o*(s*s)*e+3*r*s*i+r*o*n},t.getCubicBezierVector=function(e,i,n,o,s,r){return void 0===r&&(r=null),null===r&&(r=h.create()),r.x=t.getCubicBezierPosition(e.x,i.x,n.x,o.x,s),r.y=t.getCubicBezierPosition(e.y,i.y,n.y,o.y,s),r},t.createQuadraticBezierEnumerator=function(t,e,i,n){return void 0===n&&(n=30),new g(t,i,e,null,n)},t.createCubicBezierEnumerator=function(t,e,i,n,o){return void 0===o&&(o=30),new g(t,n,e,i,o)},t.projectPointOnLineSegment=function(t,e,i,n){var o=h.create(),s=h.create(),r=0;h.difference(t,e,o),h.difference(i,e,s),r=s.normalize();var a=h.dotProduct(o,s);return a<0?(n.x=e.x,n.y=e.y,!1):a>r?(n.x=i.x,n.y=i.y,!1):(h.scaleAdd(e,s,a,n),!0)},t.isPointOnLineSegment=function(e,i,n,o){void 0===o&&(o=2);var s=h.create();return!1!==t.projectPointOnLineSegment(e,i,n,s)&&t.isPointInCircle(e,s,o)},t.isPointInCircle=function(t,e,i){return h.difference(t,e).squaredLength<=i*i},t.isPointInRect=function(t,e,i,n,o,s){return t>=i&&t<=i+o&&e>=n&&e<=n+s},t.isPointInEllipse=function(t,e,i,n,o,s){var r=t-i,a=e-n;return r*r/(o*o)+a*a/(s*s)<=1},t.sign=function(t,e,i){var n=h.difference(t,i),o=h.difference(e,i);return h.crossProduct(n,o)},t.isPointInTriangle=function(e,i,n,o){var s=t.sign(i,n,e)<0,r=t.sign(n,o,e)<0,a=t.sign(o,i,e)<0;return s===r&&r===a},t.isPointInPolygon=function(e,i){if(i.length<3)return!1;for(var n=2;n<i.length;n++)if(t.isPointInTriangle(e,i[0],i[n-1],i[n]))return!0;return!1},t.isConvex=function(e){for(var i,n,o=t.sign(e[0],e[1],e[2])<0,s=1;s<e.length;s++)if(i=(s+1)%e.length,n=(s+2)%e.length,o!==t.sign(e[s],e[i],e[n])<0)return!1;return!0},t.transform=function(t,e,i){return void 0===i&&(i=null),null===i&&(i=h.create()),i.values[0]=t.values[0]*e.values[0]+t.values[2]*e.values[1]+t.values[4],i.values[1]=t.values[1]*e.values[0]+t.values[3]*e.values[1]+t.values[5],i},t.matStack=new d,t}(),p=function(){function t(t,e){void 0===t&&(t=1),void 0===e&&(e=1),this.values=new Float32Array([t,e])}return Object.defineProperty(t.prototype,"width",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),t.create=function(e,i){return void 0===e&&(e=1),void 0===i&&(i=1),new t(e,i)},t}(),v=function(){function t(t,e){void 0===t&&(t=new h),void 0===e&&(e=new p(1,1)),this.origin=t,this.size=e}return t.prototype.isEmpty=function(){var t=this.size.width*this.size.height;return!0===f.isEquals(t,0)},t.create=function(e,i,n,o){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=1),new t(new h(e,i),new p(n,o))},t}(),g=(function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.values=new Float32Array([t,e,i,n])}Object.defineProperty(t.prototype,"leftMargin",{get:function(){return this.values[0]},set:function(t){this.values[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topMargin",{get:function(){return this.values[1]},set:function(t){this.values[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightMargin",{get:function(){return this.values[2]},set:function(t){this.values[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomMargin",{get:function(){return this.values[3]},set:function(t){this.values[3]=t},enumerable:!0,configurable:!0})}(),function(){function t(t,e,i,n,o){void 0===n&&(n=null),void 0===o&&(o=30),this._startAnchorPoint=t,this._endAnchorPoint=e,this._controlPoint0=i,this._controlPoint1=null!==n?n:null,this._steps=o,this._i=1/this._steps,this._currentIdx=-1}return t.prototype.reset=function(){this._currentIdx=-1},Object.defineProperty(t.prototype,"current",{get:function(){return null!==this._controlPoint1?f.getCubicBezierVector(this._startAnchorPoint,this._controlPoint0,this._controlPoint1,this._endAnchorPoint,this._currentIdx*this._i):f.getQuadraticBezierVector(this._startAnchorPoint,this._controlPoint0,this._endAnchorPoint,this._currentIdx*this._i)},enumerable:!0,configurable:!0}),t.prototype.moveNext=function(){return++this._currentIdx<this._steps},Object.defineProperty(t.prototype,"steps",{get:function(){return this._i=1/this._steps,this._steps},set:function(t){this._steps=t,this.reset()},enumerable:!0,configurable:!0}),t}());!function(){function t(t,e,i,n){void 0===n&&(n=30),this._startAnchorPoint=t,this._endAnchorPoint=e,this._controlPoint0=i,this._steps=n,this._i=1/this._steps,this._currentIdx=-1}t.prototype.reset=function(){this._currentIdx=-1},Object.defineProperty(t.prototype,"current",{get:function(){var t=this._currentIdx*this._i,e=h.create(t*t,t);return f.transform(c.quadBezierBasicMatrix,e,e),e.x=this._startAnchorPoint.x*e.x+this._controlPoint0.x*e.y+this._endAnchorPoint.x,e.y=this._startAnchorPoint.y*e.x+this._controlPoint0.y*e.y+this._endAnchorPoint.y,e},enumerable:!0,configurable:!0}),t.prototype.moveNext=function(){return++this._currentIdx<this._steps},Object.defineProperty(t.prototype,"steps",{get:function(){return this._i=1/this._steps,this._steps},set:function(t){this._steps=t,this.reset()},enumerable:!0,configurable:!0})}();!function(t){t[t.MOUSEEVENT=0]="MOUSEEVENT",t[t.MOUSEDOWN=1]="MOUSEDOWN",t[t.MOUSEUP=2]="MOUSEUP",t[t.MOUSEMOVE=3]="MOUSEMOVE",t[t.MOUSEDRAG=4]="MOUSEDRAG",t[t.MOUSEOVER=5]="MOUSEOVER",t[t.MOUSEENTER=6]="MOUSEENTER",t[t.MOUSEOUT=7]="MOUSEOUT",t[t.MOUSELEAVE=8]="MOUSELEAVE",t[t.KEYBOARDEVENT=9]="KEYBOARDEVENT",t[t.KEYUP=10]="KEYUP",t[t.KEYDOWN=11]="KEYDOWN",t[t.KEYPRESS=12]="KEYPRESS"}(a||(a={}));var y=function(){function t(t,e,i,n){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),this.altKey=e,this.ctrlKey=i,this.shiftKey=n,this.type=t}return t}(),m=function(){function t(t){this.id=-1,this.enabled=!1,this.callbackData=void 0,this.countdown=0,this.timeout=0,this.onlyOnce=!1,this.callback=t}return t}(),x=function(t){function i(e,i,n,o,s,r){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===r&&(r=!1);var a=t.call(this,e,o,s,r)||this;return a.canvasPosition=i,a.button=n,a.hasLocalPosition=!1,a.localPosition=h.create(),a}return e(i,t),i}(y),_=function(t){function i(e,i,n,o,s,r,a){void 0===s&&(s=!1),void 0===r&&(r=!1),void 0===a&&(a=!1);var u=t.call(this,e,s,r,a)||this;return u.key=i,u.keyCode=n,u.repeat=o,u}return e(i,t),i}(y),E=function(){function t(t){this.timers=[],this._timeId=-1,this._fps=0,this._start=!1,this._requestId=-1,this.canvas=t,this.canvas.addEventListener("mousedown",this,!1),this.canvas.addEventListener("mouseup",this,!1),this.canvas.addEventListener("mousemove",this,!1),this.canvas.addEventListener("mouseover",this,!1),this.canvas.addEventListener("mouseenter",this,!1),this.canvas.addEventListener("mouseout",this,!1),this.canvas.addEventListener("mouseleave",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),window.addEventListener("keypress",this,!1),this._isMouseDown=!1,this._isMouseDrag=!1,this.isSupportMouseMove=!1}return t.prototype.isRunning=function(){return this._start},Object.defineProperty(t.prototype,"fps",{get:function(){return this._fps},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=this;this._start||(this._start=!0,this._lastTime=-1,this._startTime=-1,this._requestId=requestAnimationFrame(function(e){t.step(e)}))},t.prototype.step=function(t){var e=this;-1===this._startTime&&(this._startTime=t),-1===this._lastTime&&(this._lastTime=t);var i=t-this._startTime,n=t-this._lastTime;0!==n&&(this._fps=1e3/n),n/=1e3,this._lastTime=t,this._handleTimers(n),this.update(i,n),this.render(),requestAnimationFrame(function(t){e.step(t)})},t.prototype.stop=function(){this._start&&(cancelAnimationFrame(this._requestId),this._lastTime=-1,this._startTime=-1,this._start=!1)},t.prototype.update=function(t,e){},t.prototype.render=function(){},t.prototype.handleEvent=function(t){switch(t.type){case"mousedown":this._isMouseDown=!0,this.dispatchMouseDown(this._toCanvasMouseEvent(t,a.MOUSEDOWN));break;case"mouseup":this._isMouseDown=!1,this._isMouseDrag=!1,this.dispatchMouseUp(this._toCanvasMouseEvent(t,a.MOUSEUP));break;case"mouseover":this.dispatchMouseOver(this._toCanvasMouseEvent(t,a.MOUSEOVER));break;case"mouseenter":this.dispatchMouseEnter(this._toCanvasMouseEvent(t,a.MOUSEENTER));break;case"mouseout":this.dispatchMouseOut(this._toCanvasMouseEvent(t,a.MOUSEOUT));break;case"mouseleave":this._isMouseDown=!1,this._isMouseDrag=!1,this.dispatchMouseLeave(this._toCanvasMouseEvent(t,a.MOUSELEAVE));break;case"mousemove":this.isSupportMouseMove&&this.dispatchMouseMove(this._toCanvasMouseEvent(t,a.MOUSEMOVE)),this._isMouseDown&&(this._isMouseDrag=!0,this.dispatchMouseDrag(this._toCanvasMouseEvent(t,a.MOUSEDRAG)));break;case"keypress":this.dispatchKeyPress(this._toCanvasKeyBoardEvent(t,a.KEYPRESS));break;case"keydown":this.dispatchKeyDown(this._toCanvasKeyBoardEvent(t,a.KEYDOWN));break;case"keyup":this.dispatchKeyUp(this._toCanvasKeyBoardEvent(t,a.KEYUP))}},t.prototype.dispatchMouseOver=function(t){},t.prototype.dispatchMouseEnter=function(t){},t.prototype.dispatchMouseOut=function(t){},t.prototype.dispatchMouseLeave=function(t){},t.prototype.dispatchMouseDown=function(t){},t.prototype.dispatchMouseUp=function(t){},t.prototype.dispatchMouseMove=function(t){},t.prototype.dispatchMouseDrag=function(t){},t.prototype.dispatchKeyDown=function(t){},t.prototype.dispatchKeyUp=function(t){},t.prototype.dispatchKeyPress=function(t){},t.prototype._viewportToCanvasCoordinate=function(t){if(this.canvas){var e=this.canvas.getBoundingClientRect();if("mousedown"===t.type&&(console.log(" boundingClientRect : "+JSON.stringify(e)),console.log(" clientX : "+t.clientX+" clientY : "+t.clientY)),t.target){var i=0,n=0,o=0,s=0,r=window.getComputedStyle(t.target),a=r.borderLeftWidth;null!==a&&(i=parseInt(a,10)),null!==a&&(n=parseInt(a,10)),a=r.paddingLeft,null!==a&&(o=parseInt(a,10)),a=r.paddingTop,null!==a&&(s=parseInt(a,10));var u=t.clientX-e.left-i-o,l=t.clientY-e.top-n-s,c=h.create(u,l);return"mousedown"===t.type&&console.log(" 变换后的canvasPosition : "+c.toString()),c}throw alert("canvas为null"),new Error("canvas为null")}throw alert("evt . target为null"),new Error("evt . target为null")},t.prototype._toCanvasMouseEvent=function(t,e){var i=t,n=this._viewportToCanvasCoordinate(i);return new x(e,n,i.button,i.altKey,i.ctrlKey,i.shiftKey)},t.prototype._toCanvasKeyBoardEvent=function(t,e){var i=t;return new _(e,i.key,i.keyCode,i.repeat,i.altKey,i.ctrlKey,i.shiftKey)},t.prototype.addTimer=function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=!1),void 0===n&&(n=void 0);for(var o,s=0;s<this.timers.length;s++){var r=this.timers[s];if(!1===r.enabled)return r.callback=t,r.callbackData=n,r.timeout=e,r.countdown=e,r.enabled=!0,r.onlyOnce=i,r.id}return o=new m(t),o.callbackData=n,o.timeout=e,o.countdown=e,o.enabled=!0,o.id=++this._timeId,o.onlyOnce=i,this.timers.push(o),o.id},t.prototype.removeTimer=function(t){for(var e=!1,i=0;i<this.timers.length;i++)if(this.timers[i].id===t){var n=this.timers[i];n.enabled=!1,e=!0;break}return e},t.prototype._handleTimers=function(t){for(var e=0;e<this.timers.length;e++){var i=this.timers[e];!1!==i.enabled&&(i.countdown-=t,i.countdown<0&&(i.callback(i.id,i.callbackData),!1===i.onlyOnce?i.countdown=i.timeout:this.removeTimer(i.id)))}},t}(),w=function(t){function i(e){var i=t.call(this,e)||this;return i.context2D=i.canvas.getContext("2d"),i.context2D.scale(window.devicePixelRatio,window.devicePixelRatio),i}return e(i,t),i}(E);!function(t){function i(e,i){var n=t.call(this,e)||this;if(n.context3D=n.canvas.getContext("webgl",i),null===n.context3D&&(n.context3D=n.canvas.getContext("experimental-webgl",i),null===n.context3D))throw alert(" 无法创建WebGLRenderingContext上下文对象 "),new Error(" 无法创建WebGLRenderingContext上下文对象 ");return n}e(i,t)}(E);!function(t){t[t.STRETCH=0]="STRETCH",t[t.REPEAT=1]="REPEAT",t[t.REPEAT_X=2]="REPEAT_X",t[t.REPEAT_Y=3]="REPEAT_Y"}(t.EImageFillType||(t.EImageFillType={})),function(t){t[t.LEFT_TOP=0]="LEFT_TOP",t[t.RIGHT_TOP=1]="RIGHT_TOP",t[t.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",t[t.LEFT_BOTTOM=3]="LEFT_BOTTOM",t[t.CENTER_MIDDLE=4]="CENTER_MIDDLE",t[t.CENTER_TOP=5]="CENTER_TOP",t[t.RIGHT_MIDDLE=6]="RIGHT_MIDDLE",t[t.CENTER_BOTTOM=7]="CENTER_BOTTOM",t[t.LEFT_MIDDLE=8]="LEFT_MIDDLE"}(t.ELayout||(t.ELayout={}));var D=function(t,e){var i=null;return function(){var n=this,o=arguments;i||(i=setTimeout(function(){t.apply(n,Array.prototype.slice.call(o)),clearTimeout(i)},e))}},b=function(t,e){var i=null;return function(){var n=this,o=arguments;i&&clearTimeout(i),i=setTimeout(function(){t.apply(n,Array.prototype.slice.call(o))},e)}},T=(window.devicePixelRatio,function(){function t(t,e){this.name="",this.type="",this.options={x:10,y:10,w:100,h:100,lw:10,cs:"#000",cf:"#666"},this.name=t,e&&(this.options=e)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.options.x},set:function(t){this.options.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.options.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.options.w},set:function(t){this.options.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this.options.h},enumerable:!0,configurable:!0}),t.prototype.draw=function(t){if(null!==t.context2D){var e=this.options,i=e.x,n=e.y,o=e.w,s=e.h,r=e.lw,a=e.cs,u=e.cf;t.drawRect(i,n,o,s,r,a,u)}},t.prototype.update=function(){},t.prototype.mouseMove=function(){},t.prototype.mouseOver=function(){},t}()),M=function(t){function i(e,i,n){var o=this;return n.h=50,n.lw=0,n.cs="rgba(190,190,241,0.7)",n.cf="rgba(190,190,241,0.7)",o=t.call(this,i,n)||this,o.$app=e,o}return e(i,t),i.prototype.draw=function(){var t=this.$app,e=t._state;if(null!==t.context2D){var i=this.name.replace("Mask","Diamond");this.options.x=e["left"+i].x,this.options.w=e["right"+i].x-e["left"+i].x;var n=this.options,o=n.y,s=n.h,r=n.lw,a=n.cs,u=n.cf;t.drawColorReact(this.x,o,this.w,s,r,a,u)}},i}(T),O=function(t){function i(e,i,n){var o=this;return n.y=50,n.h=10,n.lw=0,n.cs="#F1BEBE",n.cf="#F1BEBE",o=t.call(this,i,n)||this,o.$app=e,o}return e(i,t),i.prototype.draw=function(){var t=this.$app;if(null!==t.context2D){this.options.x=t._state.leftMiniRect.x,this.options.w=t._state.rightMiniRect.x-t._state.leftMiniRect.x;var e=this.options,i=(e.x,e.y),n=(e.w,e.h),o=e.lw,s=e.cs,a=e.cf;t.drawColorReact(this.x,i,this.w,n,o,s,a);var u=t.calcTextSize(r(t._state.beginTime));this.$app.fillText(r(t._state.initBeginTime),10,6*this.h,"#666"),this.$app.fillText(r(t._state.initEndTime),10+t._state.axisW-u.width,6*this.h,"#666")}},i}(T),P=function(t){function i(e,i,n){var o=t.call(this,i,n)||this;return o.inDrag=!1,o.$app=e,o.type="DragEle",o}return e(i,t),i.prototype.draw=function(){var t=this.$app;if(null!==t.context2D){if(this.name.indexOf("Diamond")>-1&&(t.drawDragHandle(t._state[this.name].x,t._state[this.name].y,this.w,this.h),this.inDrag)){var e="";switch(this.name){case"leftDiamond":e=r(t._state.dragBeginTime);break;case"rightDiamond":e=r(t._state.dragEndTime);break;case"leftDiamondTwo":e=t._state.chooseBeginDeep;break;case"rightDiamondTwo":e=t._state.chooseEndDeep}t.drawMoveValue(e)}if(this.name.indexOf("MiniRect")>-1&&(t.drawRect(t._state[this.name].x-3,t._state[this.name].y-5,this.w,this.h,2,"#666","#fff"),this.inDrag)){var e=this.name.indexOf("right")>-1?t._state.chooseEndTime:t._state.chooseBeginTime;t.drawMoveValue(r(e))}}},i}(T),S={jingAxis:{begin:"chooseBeginTime",end:"chooseEndTime",beginKey:"KSSJC",endKey:"JSSJC",titleKey:"GKMC",titleName:"工况",filter:!0,dataKey:"list",colors:["#A388BB","#523669","#5E4E7B","#4D3A69","#1B0033","#A388BB","#523669","#5E4E7B","#4D3A69","#1B0033"]},deepAxis:{begin:"initBeginDeep",end:"initEndDeep",beginKey:"KSJS",endKey:"JSJS",titleKey:"CWMC",titleName:"层位",filter:!0,dataKey:"deeps",colors:["#734626","#778080","#7D4D65","#6B635B"]}},C=function(t){function o(e,i,n){var o=t.call(this,i,n)||this;return o.$app=e,o}return e(o,t),o.prototype.draw=function(){return i(this,void 0,void 0,function(){var t,e,i,o,s,a,u,l,h,c,d,f,p,v,g,y,m,x,_,E,w,D,b=this;return n(this,function(n){if(t=this.$app,e=this.$app._state,i=e.beginX,o=e.beginY,s=e.axisW,a=e.unitH,u=S[this.name],l=u.begin,h=u.end,c=u.beginKey,d=u.endKey,f=u.titleKey,p=u.titleName,v=u.filter,g=u.dataKey,y=u.colors,!(m=e[h]-e[l]))return[2];if(x=e[g],"jingAxis"===this.name)for(_=Math.floor(m/10),E=0;E<10;E++)t.fillText(r(e[l]+_*E),i+s/10*E,35,"#666");if(v&&(x=x.filter(function(t){return t[c]>e[l]&&t[d]<e[h]})),x.forEach(function(n,u){if(!(n[c]<e[l]||n[d]>e[h])){n.ratio=((n[d]-n[c])/m).toFixed(4);var v=(n[c]-e[l])/m*s,g=(n[d]-n[c])/m*s;n.leftX=v=Math.round(v),n.blockW=g=Math.round(g);var x=t._state.beginX+v,_=t._state.beginY;n.h=a,n.y=o+b.y;var E=y[u%10];if(n.hover&&!t._dragEle&&(E="red"),g>=1&&t.drawColorReact(i+v,o+b.y,g,a,0,E,E),"jingAxis"===b.name){if(!t.context2D)return;/^10203\d{2}$/.test(n.GKDM)&&t.context2D.drawImage(t.icon,i+v,o+b.y-10,10,10)}if("deepAxis"===b.name){t.drawLine(i+v+g,o+8*a,i+v+g,o+11*a,.5);g>t.calcTextSize(n[f]).width&&t.fillText(n[f],i+v+5,o+3+7*a,"#666");g>t.calcTextSize(String(n[c])).width&&t.fillText(n[c],i+v+5,o+11*a,"#666")}if(n.hover&&!t._dragEle){var w=p+"："+n[f],D="开始："+("jingAxis"===b.name?r(n[c]):n[c]),T="结束："+("jingAxis"===b.name?r(n[d]):n[d]),M=x,O=_+3*a,P=t.calcTextSize(w),S=t.calcTextSize(D);t.drawColorReact(M+5,O,Math.max(P.width,S.width)+5,3*P.height,.5,"#333","#fff"),t.fillText(w,M+5,O+8,"#666","left","middle"),O+=P.height,t.fillText(D,M+5,O+8,"#666","left","middle"),O+=P.height,t.fillText(T,M+5,O+8,"#666","left","middle")}}}),"jingAxis"===this.name){if(t.drawLine(i,o+1.5*a,i+s,o+1.5*a,.5),!(w=t._state.nodes))return[2];D=0,w.forEach(function(n){var o=(n.KCSJSJC-e[l])/m*s,r=(n.KCSJSJC-D)/m*s,a=t.calcTextSize(n.KCMC).width,u=o;a>r&&(u=o+(a-r)),D=n.KCSJSJC,t.drawLine(i+o,10,i+o,15,.5),t.fillText(n.KCMC,u+10,3,"#666")})}return[2]})})},o}(T),B=function(o){function r(t,e){var i=o.call(this,t)||this;i._lineDashOffset=0,i._mouseX=0,i._mouseY=0,i._isMouseDrag=!1,i._dragEle=null,i._mouseIn=!1,i._eventMap={},i._state={},i._options={},i._spirit=[],i.leftDiamond=null,i.rightDiamond=null,i.leftMiniRect=null,i.rightMiniRect=null,i.leftDiamondTwo=null,i.rightDiamondTwo=null,i.mask=null,i.maskTwo=null,i.jingAxis=null,i.deepAxis=null,i.timeAxis=null,i.icon=null;var n={width:i.canvas.width/(window.devicePixelRatio||1),height:i.canvas.height/(window.devicePixelRatio||1)},s=n.width-20;return i.isSupportMouseMove=!0,i._options=e,i._state={beginX:10,beginY:0,unitH:10,axisW:s,axisH:0,leftDiamond:{x:10,y:25,w:10,h:50},rightDiamond:{x:10+s,y:25,w:10,h:50},leftMiniRect:{x:10,y:55,w:6,h:10},rightMiniRect:{x:10+s,y:55,w:6,h:10},leftDiamondTwo:{x:10,y:95,w:10,h:50},rightDiamondTwo:{x:10+s,y:95,w:10,h:50}},i.initConfig(e),i._state.list&&i._state.deeps?(i._state.bgs={abg:{y:0,h:5,cf:"#E7EBEA"},axbg:{y:2,h:1,cf:"#CCC"},txbg:{y:5,h:1,cf:"#CCC"},dbg:{y:7,h:5,cf:"#E7EBEA"},dxbg:{y:9,h:1,cf:"#CCC"}},i.init(),i.draw(),i):i}return e(r,o),r.prototype.initConfig=function(t){return t.initEndTime&&t.initEndDeep?t.list&&t.deeps?(this._state.initBeginTime=t.initBeginTime,this._state.initEndTime=t.initEndTime,this._state.initBeginDeep=0,this._state.initEndDeep=t.initEndDeep,this._state.chooseBeginTime=t.initBeginTime,this._state.chooseEndTime=t.initEndTime,this._state.dragBeginTime=t.initBeginTime,this._state.dragEndTime=t.initEndTime,this._state.chooseBeginDeep=t.initBeginDeep,this._state.chooseEndDeep=t.initEndDeep,this._state.list=t.list,this._state.deeps=t.deeps,this._state.nodes=t.nodes,void(this.icon=t.icon)):void console.error("初始数据不能为空"):void console.error("初始范围不能为空")},r.prototype.init=function(){
this.createBg(),this.createMask(),this.createData(),this.createDragEle()},r.prototype.draw=function(){if(this.context2D&&(this.context2D.clearRect(0,0,this.canvas.width,this.canvas.height),this._spirit.length))for(var t=this._spirit,e=0;e<t.length;e++)t[e].draw(this)},r.prototype.update=function(){this.draw()},r.prototype.changeData=function(t,e,i,n,o,s){(i||"string"==typeof i)&&(i=Number(i)),(n||"string"==typeof n)&&(n=Number(n));var r=this._state.axisW;if(t){if(t>this._state.initEndTime||t<this._state.initBeginTime)return void console.warn("时间超出 hist_condition 初始范围");this._state.chooseBeginTime=t}if(e){if(e>this._state.initEndTime||e<this._state.initBeginTime)return void console.warn("时间超出 hist_condition 初始范围");this._state.chooseEndTime=e}var a=this._state.initEndDeep-this._state.initBeginDeep,u=this._state.initEndTime-this._state.initBeginTime;this._state.chooseBeginTime,this._state.chooseEndTime;if(t&&e&&(this._state.leftDiamond.x=10,this._state.rightDiamond.x=r+10,this._state.leftMiniRect.x=(t-this._state.initBeginTime)/u*r+10,this._state.rightMiniRect.x=(e-this._state.initBeginTime)/u*r+10),n>this._state.initEndDeep)return void console.warn("深度超出 hist_condition 初始范围");this._state.leftDiamondTwo.x=(i-this._state.initBeginDeep)/a*r+10,this._state.rightDiamondTwo.x=(n-this._state.initBeginDeep)/a*r+10,this._state.chooseBeginDeep=i,this._state.chooseEndDeep=n,this.update()},r.prototype.createDragEle=function(){var t=this._state,e=["leftDiamond","rightDiamond","leftMiniRect","rightMiniRect","leftDiamondTwo","rightDiamondTwo"];for(var i in t)if(e.includes(i)){var n=new P(this,i,t[i]);this._spirit.push(n),this[i]=n}},r.prototype.createMask=function(){this.mask=new M(this,"Mask",{y:0}),this._spirit.push(this.mask),this.maskTwo=new M(this,"MaskTwo",{y:this._state.beginY+7*this._state.unitH}),this._spirit.push(this.maskTwo)},r.prototype.createData=function(){this.timeAxis=new O(this,"timeAxis",{}),this._spirit.push(this.timeAxis),this.jingAxis=new C(this,"jingAxis",{x:this._state.beginX,y:2*this._state.unitH,w:this._state.axisW,h:this._state.unitH}),this._spirit.push(this.jingAxis),this.deepAxis=new C(this,"deepAxis",{x:this._state.beginX,y:9*this._state.unitH,w:this._state.axisW,h:this._state.unitH}),this._spirit.push(this.deepAxis)},r.prototype.createBg=function(){var t=this._state.bgs,e=this._state.unitH,i=this._state.axisW;for(var n in t){var o=t[n],s=new T(n,{x:this._state.beginX,y:this._state.beginY+o.y*e,w:i,h:o.h*e,lw:1,cs:o.cf,cf:o.cf});this._spirit.push(s)}},r.prototype.isPointInSpirit=function(t,e){var i=null,n=this._spirit.length;if(n){for(var o=n-1;o>0;o--){var s=this._spirit[o],r=s.x,a=s.y,u=s.w,l=s.h;"DragEle"===s.type&&(r-=u/2,a-=l/2),f.isPointInRect(t,e,r,a,u,l)&&(i||(i=s))}return i}},r.prototype.clearStatus=function(){this._state.deeps.forEach(function(t){t.hover&&delete t.hover}),this._state.list.forEach(function(t){t.hover&&delete t.hover})},r.prototype.calcCurrent=function(){var t=0;return this._mouseX>=this._state.beginX&&this._mouseX<=this._state.axisW+this._state.beginX&&(t=(this._mouseX-this._state.beginX)/this._state.axisW),t},r.prototype.calcPosition=function(t,e,i,n,o){var s=this._state[e],r=this._state[i],a=r-s,u=this._state[n],l=this._state[o];if(t.name.indexOf("left")>-1?u=Math.round(this.calcCurrent()*a)+s:t.name.indexOf("right")>-1&&(l=Math.round(this.calcCurrent()*a)+s),!(u>l))return this._state[n]=u,this._state[o]=l,{cb:u,ce:l}},r.prototype.drawMoveValue=function(t){if(this._isMouseDrag&&this._dragEle){var e,i,n,o,s,r=this._dragEle;s=this.calcTextSize(t),n=s.width,o=s.height,i=r.y+10,e=this._dragEle.name&&this._dragEle.name.indexOf("left")>-1?r.x:r.x-n-5,this.drawColorReact(e,i,n,o,0,"#fff","#fff"),this.fillText(t,e+n/2,i+o/2,"#666","center","middle")}},r.prototype.$on=function(t,e){this._eventMap[t]||(this._eventMap[t]=[]),this._eventMap[t].push(e)},r.prototype.$emit=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=this._eventMap[t];o&&o.forEach(function(t){t.apply(e,s(i))})},r.prototype.dispatchMouseOver=function(t){},r.prototype.dispatchMouseEnter=function(t){},r.prototype.dispatchMouseOut=function(t){},r.prototype.dispatchMouseLeave=function(t){this.clearStatus(),this.update()},r.prototype.dispatchMouseMove=function(t){this._mouseX=t.canvasPosition.x,this._mouseY=t.canvasPosition.y,this._dragEle||b(this.onMove,50).call(this)},r.prototype.onMove=function(){var t=this,e=this._state.beginX,i=this._state.beginY,n=this.isPointInSpirit(this._mouseX,this._mouseY),o=function(n,o){return f.isPointInRect(t._mouseX,t._mouseY,n.leftX+e,n.y+i,n.blockW,n.h)?(n.hover=!0,!0):(n.hover=!1,!1)};if(n&&["jingAxis","deepAxis"].includes(n.name)){this._mouseIn=!0;var s=this._state.deeps.filter(o),r=this._state.list.filter(o);[].concat(s).concat(r).length&&!this._dragEle&&this.update()}else this._mouseIn&&(this.clearStatus(),this.update(),this._mouseIn=!1)},r.prototype.dispatchMouseDown=function(t){this._mouseX=t.canvasPosition.x,this._mouseY=t.canvasPosition.y;var e=this.isPointInSpirit(this._mouseX,this._mouseY);console.log("eleObj",e),e&&(this._dragEle=e,console.log(e)),this._dragEle&&"DragEle"===this._dragEle.type&&"pointer"!==this.canvas.style.cursor&&(this.canvas.style.cursor="pointer")},r.prototype.dispatchMouseUp=function(t){var e=(this._dragEle,this._dragEle?this._dragEle.name:""),i=this._state;e.indexOf("MiniRect")>-1&&this.$emit("changeTime",i.chooseBeginTime,i.chooseEndTime),e.indexOf("Diamond")>-1&&-1==e.indexOf("DiamondTwo")&&this.$emit("changeGK",i.dragBeginTime,i.dragEndTime),e.indexOf("DiamondTwo")>-1&&this.$emit("changeDeep",i.chooseBeginDeep,i.chooseEndDeep),this.clearStatus(),this._dragEle&&(this._dragEle.inDrag=!1,this._dragEle=null),this.update(),this.canvas.style.cursor="default"},r.prototype.dispatchMouseDrag=function(t){this._mouseX=t.canvasPosition.x,this._mouseY=t.canvasPosition.y,D(this.onDrag,50).call(this)},r.prototype.onDrag=function(){if(this._isMouseDrag&&this._dragEle){if("DragEle"!==this._dragEle.type)return;if(this._mouseX<this._state.beginX||this._mouseX>this._state.axisW+this._state.beginX)return void console.warn("鼠标超出范围");if(this._dragEle.name.indexOf("left")>-1){var t=this._dragEle.name.replace("left","right"),e=this[t];if(this._mouseX>e.x-e.w)return}if(this._dragEle.name.indexOf("right")>-1){var i=this._dragEle.name.replace("right","left"),n=this[i];if(this._mouseX<n.x+n.w)return}this._dragEle.x=this._mouseX,this._dragEle.inDrag=!0,"DragEle"===this._dragEle.type&&(this._dragEle.name.indexOf("MiniRect")>-1&&(this._state.dragBeginTime=this._state.chooseBeginTime,this._state.dragEndTime=this._state.chooseEndTime,this._state.leftDiamond.x=10,this._state.rightDiamond.x=this._state.axisW+10,this.calcPosition(this._dragEle,"initBeginTime","initEndTime","chooseBeginTime","chooseEndTime")),this._dragEle.name.indexOf("Diamond")>-1&&-1==this._dragEle.name.indexOf("DiamondTwo")&&this.calcPosition(this._dragEle,"chooseBeginTime","chooseEndTime","dragBeginTime","dragEndTime"),this._dragEle.name.indexOf("DiamondTwo")>-1&&this.calcPosition(this._dragEle,"initBeginDeep","initEndDeep","chooseBeginDeep","chooseEndDeep")),this.update()}},r.prototype.dispatchKeyPress=function(t){},r.prototype.drawColorReact=function(t,e,i,n,o,s,r){null!==this.context2D&&(this.context2D.save(),this.context2D.lineWidth=o,this.context2D.strokeStyle=s,this.context2D.fillStyle=r,this.context2D.beginPath(),this.context2D.moveTo(t,e),this.context2D.lineTo(t+i,e),this.context2D.lineTo(t+i,e+n),this.context2D.lineTo(t,e+n),this.context2D.closePath(),this.context2D.fill(),this.context2D.stroke(),this.context2D.restore())},r.prototype.drawDiamond=function(t,e,i,n,o){t&&e&&i&&n&&null!==this.context2D&&(this.context2D.save(),this.context2D.lineWidth=2,this.context2D.strokeStyle=o||"silver",this.context2D.fillStyle="white",this.context2D.beginPath(),this.context2D.moveTo(t-i/2,e),this.context2D.lineTo(t,e+n/2),this.context2D.lineTo(t+i/2,e),this.context2D.lineTo(t,e-n/2),this.context2D.closePath(),this.context2D.fill(),this.context2D.stroke(),this.context2D.restore())},r.prototype.drawLine=function(t,e,i,n,o,s){null!==this.context2D&&(this.context2D.lineWidth=o,this.context2D.strokeStyle=s||"black",this.context2D.beginPath(),this.context2D.moveTo(t,e),this.context2D.lineTo(i,n),this.context2D.stroke())},r.prototype.drawDragHandle=function(t,e,i,n,o){var s=n-10;this.drawLine(t,e+n/2,t,e-n/2,.5),this.drawDiamond(t,e,10,s/2,"black")},r.prototype.drawRect=function(t,e,i,n,o,s,r){void 0===t&&(t=0),void 0===e&&(e=0),null!==this.context2D&&(this.context2D.save(),this.context2D.lineWidth=o||20,this.context2D.strokeStyle=s||"blue",this.context2D.fillStyle=r||"grey",this.context2D.beginPath(),this.context2D.moveTo(t,e),this.context2D.lineTo(t+i,e),this.context2D.lineTo(t+i,e+n),this.context2D.lineTo(t,e+n),this.context2D.closePath(),this.context2D.fill(),this.context2D.stroke(),this.context2D.restore())},r.prototype.printLineStates=function(){null!==this.context2D&&(console.log(" *********LineState********** "),console.log(" lineWidth : "+this.context2D.lineWidth),console.log(" lineCap : "+this.context2D.lineCap),console.log(" lineJoin : "+this.context2D.lineJoin),console.log(" miterLimit : "+this.context2D.miterLimit))},r.prototype._updateLineDashOffset=function(){++this._lineDashOffset>1e4&&(this._lineDashOffset=0)},r.prototype.fillCircle=function(t,e,i,n){void 0===n&&(n="red"),null!==this.context2D&&(this.context2D.save(),this.context2D.fillStyle=n,this.context2D.beginPath(),this.context2D.arc(t,e,i,0,2*Math.PI),this.context2D.fill(),this.context2D.restore())},r.prototype.loadImage=function(t){return i(this,void 0,void 0,function(){var e;return n(this,function(i){return e=document.createElement("img"),e.src=t,[2,new Promise(function(t,i){e.onload=function(i){t(e)},e.onerror=function(t){i(t)}})]})})},r.prototype.drawImage=function(e,i,n,o){return void 0===n&&(n=v.create(0,0,e.width,e.height)),void 0===o&&(o=t.EImageFillType.STRETCH),null!==this.context2D&&(!n.isEmpty()&&(!i.isEmpty()&&(o===t.EImageFillType.STRETCH&&this.context2D.drawImage(e,n.origin.x,n.origin.y,n.size.width,n.size.height,i.origin.x,i.origin.y,i.size.width,i.size.height),!0)))},r.prototype.printTextStates=function(){null!==this.context2D&&(console.log(" *********TextState********** "),console.log(" font : "+this.context2D.font),console.log(" textAlign : "+this.context2D.textAlign),console.log(" textBaseline : "+this.context2D.textBaseline))},r.prototype.fillText=function(t,e,i,n,o,s,r){void 0===n&&(n="white"),void 0===o&&(o="left"),void 0===s&&(s="top"),void 0===r&&(r="10px sans-serif"),null!==this.context2D&&(this.context2D.save(),this.context2D.textAlign=o,this.context2D.textBaseline=s,this.context2D.font=r,this.context2D.fillStyle=n,this.context2D.fillText(t,e,i),this.context2D.restore())},r.prototype.calcTextSize=function(t,e,i){if(void 0===e&&(e="W"),void 0===i&&(i=.5),null!==this.context2D){var n=new p;n.width=this.context2D.measureText(t).width;var o=this.context2D.measureText(e).width;return n.height=o+o*i,n}throw alert(" context2D 渲染上下文为null "),new Error(" context2D 渲染上下文为null ")},r.prototype.makeFontString=function(t,e,i,n,o){void 0===t&&(t="10px"),void 0===e&&(e="normal"),void 0===i&&(i="normal"),void 0===n&&(n="normal"),void 0===o&&(o="sans-serif");var s=[];return s.push(i),s.push(n),s.push(e),s.push(t),s.push(o),s.join(" ")},r.prototype.printShadowStates=function(){null!==this.context2D&&(console.log("*********ShadowState**********"),console.log(" shadowBlur : "+this.context2D.shadowBlur),console.log(" shadowColor : "+this.context2D.shadowColor),console.log(" shadowOffsetX : "+this.context2D.shadowOffsetX),console.log(" shadowOffsetY : "+this.context2D.shadowOffsetY))},r.prototype.setShadowState=function(t,e,i,n){void 0===t&&(t=5),void 0===e&&(e="rgba( 127 , 127 , 127 , 0.5 )"),void 0===i&&(i=10),void 0===n&&(n=10),null!==this.context2D&&(this.context2D.shadowBlur=t,this.context2D.shadowColor=e,this.context2D.shadowOffsetX=i,this.context2D.shadowOffsetY=n)},r.prototype.printAllRenderStates=function(){null!==this.context2D&&(console.log(" *********LineState********** "),console.log(" lineWidth : "+this.context2D.lineWidth),console.log(" lineCap : "+this.context2D.lineCap),console.log(" lineJoin : "+this.context2D.lineJoin),console.log(" miterLimit : "+this.context2D.miterLimit),console.log(" *********LineDashState********** "),console.log(" lineDashOffset : "+this.context2D.lineDashOffset),console.log(" *********ShadowState********** "),console.log(" shadowBlur : "+this.context2D.shadowBlur),console.log(" shadowColor : "+this.context2D.shadowColor),console.log(" shadowOffsetX : "+this.context2D.shadowOffsetX),console.log(" shadowOffsetY : "+this.context2D.shadowOffsetY),console.log("*********TextState**********"),console.log(" font : "+this.context2D.font),console.log(" textAlign : "+this.context2D.textAlign),console.log(" textBaseline : "+this.context2D.textBaseline),console.log("*********RenderState**********"),console.log(" strokeStyle : "+this.context2D.strokeStyle),console.log(" fillStyle : "+this.context2D.fillStyle),console.log(" globalAlpha : "+this.context2D.globalAlpha),console.log(" globalCompositeOperation : "+this.context2D.globalCompositeOperation))},r.MainColors={lightgray:"#E7EBEA",gray:"gray",mcolor:"#BEBEF1",abg:"#E7EBEA",axbg:"#CCC",txbg:"#CCC",dbg:"#E7EBEA",dxbg:"#CCC"},r.Colors=["aqua","black","blue","fuchsia","gray","green","lime","maroon","navy","olive","orange","purple","red","silver","teal","yellow","white"],r}(w);t.AxisApplication=B,Object.defineProperty(t,"__esModule",{value:!0})});
